import{k as P,r as p,V as b,v as S,$ as I,n as u,s as j,af as E,ak as w,al as O,j as o,am as C,an as N,ao as R}from"./index-VLfZ_LXD.js";import{C as K}from"./CheckOutSteps-CMcOS_mw.js";const q=r=>new Promise(n=>{const e=document.createElement("script");e.src=r,e.onload=()=>{n(!0)},e.onerror=()=>{n(!1)},document.body.appendChild(e)}),F=()=>{const{enqueueSnackbar:r}=P(),{rzpKey:n}=p.useContext(b),e=S(),g=I(),c=JSON.parse(sessionStorage.getItem("orderInfo")),a=u(j),v=u(E),m=u(w),[y,A]=p.useState(""),i=c==null?void 0:c.totalPrice,s=parseInt(i==null?void 0:i.replace("â‚¹","").replace(/,/g,""));console.log(s);const x=async()=>{try{return await q("https://checkout.razorpay.com/v1/checkout.js")?!0:(r("Razorpay SDK failed to load. Please check your internet connection.'",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"center"}}),!1)}catch(t){return console.error("Failed to load Razorpay SDK:",t),!1}},k=async()=>{if(!await x())return;const l={key:n,amount:s*100,currency:"INR",name:a.name,description:"Payment for your order",image:a.avatar,handler:d=>{z()},prefill:{name:a.name,email:a.email,contact:a.phoneNumber},theme:{color:"#3399cc"}};new window.Razorpay(l).open()},z=async()=>{try{const{data:t}=await C.post("/payment/process",{amount:s}),l=t.clientSecret,h=v.map(f=>({productId:f.productId,quantity:f.quantity})),d={totalPrice:s,orderItems:h,paymentInfo:{id:l,status:"success"}};console.log(d),await e(N(d)),e(R()),g("/payment-success"),r("Payment successfull and Your Items ordered!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"center"}})}catch{r("Failed to submit payment to backend. Please try again later.",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"center"}})}};return p.useEffect(()=>{if(m){r(m,{variant:"error",anchorOrigin:{vertical:"top",horizontal:"center"},onExited:()=>{e(O())}});return}},[]),o.jsxs("div",{className:"container",style:{marginTop:"130px",minHeight:"100vh"},children:[o.jsx(K,{payment:!0}),o.jsx("div",{className:"d-flex align-items-center justify-content-center ",children:o.jsx("button",{className:"btn btn-primary",onClick:k,children:"Pay with Razorpay"})}),y&&o.jsx("p",{style:{color:"red"},children:y})]})};export{F as default};
